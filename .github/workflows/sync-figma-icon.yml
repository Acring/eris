# 将 figma 中的图标转换为 svg 文件，再将 svg 文件转换为 react 组件
name: sync-figma-icon
on:
  workflow_dispatch:
    inputs:
      type:
        description: 'type'
        required: true
        type: choice
        options:
          - 'feat'
          - 'fix'
      info:
        description: 'info'
        required: true
        type: string

jobs:
  sync-figma-icon:
    name: sync-figma-icon
    runs-on: [frontend, container]
    container: harbor.xsky.com/pluto/node-alpine-git:18
    env:
      TYPE: ${{ github.event.inputs.type }}
      INFO: ${{ github.event.inputs.info }}
      FIGMA_FILE_URL: ${{ secrets.FIGMA_FILE_URL }}
      FIGMA_TOKEN: ${{ secrets.FIGMA_TOKEN }}

    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.MY_GITHUB_TOKEN }}
      - run: |
          yarn install
      - name: figma to svg
        run: |
          yarn workspace @xsky/eris-icons figma-to-svg
      - name: svg to code
        run: |
          yarn workspace @xsky/eris-icons svg-to-code
      - name: commit and push
        run: |
          git config --global user.email "liu.zhen@xsky.com"
          git config --global user.name "liu.zhen"
          git add .
          git commit -am "${{env.TYPE}}: update icon\n\n${{ env.INFO }}" --no-verify
          git push
      - name: Feishu Notification
        if: failure()
        uses: fezhengjin/actions-feishu-xsky@1.4
        with:
          webhook: ${{ secrets.FEISHU_BOT_WEBHOOK }}
          title: '@xsky/eris-icons 添加失败'
          content: |
            😭 @xsky/eris-icons 添加失败，请检查代码并重新提交。
            详见: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

      - name: Feishu Notification
        uses: fezhengjin/actions-feishu-xsky@1.4
        with:
          webhook: ${{ secrets.FEISHU_BOT_WEBHOOK }}
          title: '@xsky/eris-icons 新版本'
          content: |
            🎉 @xsky/eris-icons 新版本代码已提交，请等待发布通知。
            发布信息: ${{ env.TYPE }}: ${{ env.INFO }}
